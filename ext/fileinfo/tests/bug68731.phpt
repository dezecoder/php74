--TEST--
Bug #68731 (finfo_buffer doesn't extract the correct mime with some gifs)
--SKIPIF--
<?php require_once(dirname(__FILE__) . '/skipif.inc'); ?>
--FILE--
<?php

// This is not a complete gif - but it contains enough bytes to 
// show the issue.
$testGif =
"\x47\x49\x46\x38\x39\x61\x20\x00\x20\x00\xe7\x9e\x00\x00\x00\x00".
"\x00\x3f\xa1\x00\x3f\xad\x07\x3f\xa0\x03\x41\xae\x00\x42\xae\x00".
"\x44\x9d\x04\x42\xae\x00\x44\xaf\x06\x44\xaf\x00\x46\xaf\x00\x47".
"\xaf\x08\x45\xb0\x00\x48\xb0\x09\x46\xb0\x00\x49\xb0\x00\x4a\xb0".
"\x00\x4d\xb1\x00\x4f\xb2\x00\x52\xb3\x00\x53\xb1\x14\x4e\xb3\x00".
"\x55\xb4\x00\x56\xb4\x16\x50\xb4\x00\x57\xb4\x00\x59\xac\x00\x59".
"\xb5\x19\x52\xb5\x00\x5c\xb6\x00\x5e\xa6\x00\x5e\xb7\x00\x5f\xb7".
"\x00\x60\xb1\x00\x60\xb3\x00\x60\xb7\x00\x61\xb7\x00\x62\xb4\x00".
"\x62\xb8\x00\x62\xbc\x00\x64\xad\x00\x63\xbc\x00\x64\xb9\x00\x64".
"\xba\x2c\x59\xa9\x00\x65\xb9\x07\x65\xb5\x00\x66\xc5\x00\x67\xc3".
"\x00\x68\xba\x00\x69\xba\x00\x6a\xba\x00\x6b\xbb\x00\x6a\xcb\x00".
"\x6c\xbb\x2d\x61\xb9\x00\x6f\xbc\x00\x70\xbc\x00\x6e\xd4\x00\x71".
"\xc3\x38\x63\xb0\x00\x74\xbd\x00\x74\xbe\x00\x75\xbe\x00\x77\xac".
"\x3c\x65\xae\x00\x73\xda\x35\x67\xbe\x00\x77\xbf\x00\x78\xbf\x3d".
"\x68\xb4\x37\x69\xbf\x00\x7c\xc0\x3c\x6c\xc0\x3d\x6c\xbf\x00\x7e".
"\xc1\x00\x7f\xbc\x00\x7f\xc1\x47\x6c\xad\x00\x80\xc1\x2b\x75\xb3".
"\x47\x6d\xb1\x00\x7e\xde\x00\x81\xc2\x00\x82\xc3\x48\x6f\xb4\x00".
"\x83\xc3\x00\x86\xc4\x00\x87\xc0\x00\x88\xba\x00\x88\xc5\x00\x89".
"\xc6\x00\x8b\xb6\x00\x87\xe1\x00\x8b\xc7\x4b\x77\xc5\x00\x8d\xc8".
"\x00\x8e\xc8\x00\x8f\xc9\x36\x80\xbf\x00\x90\xc9\x00\x92\xca\x00".
"\x93\xcb\x00\x92\xe4\x00\x95\xc7\x00\x95\xcb\x00\x95\xcc\x00\x96".
"\xcc\x5c\x7f\xbc\x00\x9a\xce\x00\x9b\xce\x00\x9c\xcf\x00\x9a\xe7".
"\x00\x9d\xd0\x64\x83\xbb\x00\x9f\xd0\x4d\x8b\xba\x00\xa0\xd1\x66".
"\x86\xbc\x00\xa1\xe4\x00\xa3\xd3\x00\xa4\xd3\x5a\x8d\xb8\x00\xa6".
"\xd4\x00\xa9\xd5\x00\xa8\xe8\x00\xaa\xd6\x00\xab\xd3\x70\x8c\xbe".
"\x00\xab\xd6\x00\xab\xde\x00\xae\xd8\x00\xaf\xd8\x00\xb1\xca\x00".
"\xaf\xe0\x00\xb2\xd1\x00\xb2\xd8\x00\xb4\xd0\x00\xb3\xda\x00\xb8".
"\xdc\x00\xba\xde\x00\xbd\xdf\x00\xc0\xe0\x00\xc0\xe1\x00\xc1\xe1".
"\x00\xc7\xe4\x00\xc8\xe5\x00\xcb\xe6\x00\xcf\xe3\x00\xd0\xe8\x00".
"\xd1\xe9\x02\xd2\xdb\x00\xd4\xea\x00\xd9\xe0\x00\xdb\xee\x00\xdd".
"\xe9\x00\xdd\xef\x00\xe4\xf2\xff\xff\xff\xff\xff\xff\xff\xff\xff".
"\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff".
"\xff\xff\xff\xff";

$finfo = finfo_open(FILEINFO_MIME_TYPE);

echo finfo_buffer($finfo, substr($testGif, 0, 515))."\n"; // Display `'image/gif'` as expected
echo finfo_buffer($finfo, substr($testGif, 0, 516))."\n"; // Display `'application/octet-stream'`
?>
===DONE===
--EXPECTF--
image/gif
image/gif
===DONE===
